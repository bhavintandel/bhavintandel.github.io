
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet/less" type="text/css" href="/theme/stylesheet/style.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js" type="text/javascript"></script>


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">












 

<meta name="author" content="Bhavin Tandel" />
<meta name="description" content="If I am not wrong, then almost everyone in data engineering industry have heard of Apache Spark and if not (highly unlikely) then you are just one google search away for ample number resources. This post will revolve around Spark, AWS Glue, notebook and binding these tools for optimal results …" />
<meta name="keywords" content="devops">


  <meta property="og:site_name" content="Professional Portfolio"/>
  <meta property="og:title" content="Blog: Connect Jupyter Notebook to AWS Glue Endpoint"/>
  <meta property="og:description" content="If I am not wrong, then almost everyone in data engineering industry have heard of Apache Spark and if not (highly unlikely) then you are just one google search away for ample number resources. This post will revolve around Spark, AWS Glue, notebook and binding these tools for optimal results …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/blogs/devops-jupyter-connect-aws-glue/2020/11/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2020-11-12 12:00:00+00:00"/>
  <meta property="article:modified_time" content="2020-11-12 12:00:00+00:00"/>
  <meta property="article:author" content="/author/bhavin-tandel.html">
  <meta property="article:section" content="blogs"/>
  <meta property="article:tag" content="devops"/>
  <meta property="og:image" content="">

  <title>Professional Portfolio &ndash; Blog: Connect Jupyter Notebook to AWS Glue Endpoint</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="/">
      <img src="/theme/img/profile.png" alt="" title="">
    </a>

    <h1>
      <a href="/"></a>
    </h1>



    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="/pages/about.html#about">
                About
              </a>
            </li>
            <li>
              <a target="_self"
                 href="/pages/contact.html#contact">
                Contact
              </a>
            </li>
            <li>
              <a target="_self"
                 href="/pages/resume.html#resume">
                Resume
              </a>
            </li>

      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-LinkedIn"
           href="https://www.linkedin.com/in/bhavintandel/"
           target="_blank">
          <i class="fa-brands fa-LinkedIn"></i>
        </a>
      </li>
      <li>
        <a class="sc-Github"
           href="https://github.com/bhavintandel"
           target="_blank">
          <i class="fa-brands fa-Github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="devops-jupyter-connect-aws-glue">Blog: Connect Jupyter Notebook to AWS Glue Endpoint</h1>
    <p>
      Posted on Thu 12 November 2020 in <a href="/category/blogs.html">blogs</a>

    </p>
  </header>


  <div>
    <p>If I am not wrong, then almost everyone in data engineering industry have heard of Apache Spark and if not (highly unlikely) then you are just one google search away for ample number resources. This post will revolve around Spark, AWS Glue, notebook and binding these tools for optimal results.</p>
<p><img alt="The jupyter pipeline" src="/blogs/devops-jupyter-connect-aws-glue/2020/11/jupyter_pipeline.png"></p>
<h2>Introduction</h2>
<p>As Spark has been here for more than 10 years and industry have recognized its potential, thus many companies have orchestrated this framework and started providing it as service. Amazon is of it with offerings like AWS EMR and AWS Glue (Fully managed). AWS has done most of the heavy lifting for us and provided fully managed spark service which can be scaled to more than TB of memory. It also provides Glue Endpoint, which is long running spark cluster and you can connect to its REPL or launch a zeppelin or jupyter notebook deployed in cloud.</p>
<p>However, as a developer wants to retain all the notebook he/she creates for future(I think it make sense to save anyway, losing something is hurtful), one has to implement some custom logic like saving in S3 or Github or downloading locally(not a good decision at all). It makes sense if we can just leverage our locally installed jupyter and connect to spark, we dont need to change much and plus more importantly it saves $$ (For running notebook in cloud).</p>
<h2>Set up</h2>
<p>We will need a:</p>
<ul>
<li>Glue Endpoint</li>
<li>Jupyter Notebook</li>
<li>sparkmagic</li>
</ul>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>jupyter
pip<span class="w"> </span>install<span class="w"> </span>sparkmagic
python<span class="w"> </span>-m<span class="w"> </span>jupyter<span class="w"> </span>nbextension<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--py<span class="w"> </span>--sys-prefix<span class="w"> </span>widgetsnbextension
</code></pre></div>

<h3>Install spark kernels</h3>
<p>Get the spark magic location and ‘cd’ to that directory</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get the sparkmagic location </span>
pip<span class="w"> </span>show<span class="w"> </span>sparkmagic

<span class="c1"># The location will be different for you</span>
<span class="nb">cd</span><span class="w"> </span>~/.local/share/virtualenvs/jupyter_to_glue-5i9d0kFW/lib/python3.6/site-packages

<span class="c1"># Install spark kernel for scala spark</span>
jupyter-kernelspec<span class="w"> </span>install<span class="w"> </span>sparkmagic/kernels/sparkkernel

<span class="c1"># Install pyspark kernel for python spark</span>
jupyter-kernelspec<span class="w"> </span>install<span class="w"> </span>sparkmagic/kernels/pysparkkernel
</code></pre></div>

<p>Copy the config.json into ~/.sparkmagic/config.json</p>
<h2>Connection to AWS Glue Endpoint</h2>
<p>I believe you would have launched glue endpoint with your public ssh key, it will take nearly 10 mins for it be available to connect.</p>
<p>After provisioning, get the details to connect to Glue Endpoint, for example something like</p>
<div class="highlight"><pre><span></span><code><span class="err">`</span><span class="n">ssh</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="n">private</span><span class="o">-</span><span class="k">key</span><span class="p">.</span><span class="n">pem</span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="n">vnNT</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="err">:</span><span class="mi">9007</span><span class="err">:</span><span class="mf">169.254.76.1</span><span class="err">:</span><span class="mi">9007</span><span class="w"> </span><span class="n">glue</span><span class="nv">@ec2</span><span class="err">–</span><span class="mi">3</span><span class="err">–</span><span class="mi">70</span><span class="err">–</span><span class="mi">179</span><span class="err">–</span><span class="mf">133.</span><span class="k">compute</span><span class="o">-</span><span class="mf">1.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span><span class="err">`</span>
</code></pre></div>

<p>However, we need to change the SSH tunnelling port to get tunnel the Livy server port (8998) which is a rest client to connect to spark cluster. And thus the final tunnelling looks like</p>
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa<span class="w"> </span>-vnNT<span class="w"> </span>-L<span class="w"> </span><span class="m">8998</span>:169.254.76.1:8998<span class="w"> </span>glue@ec2–3–70–179–133.compute-1.amazonaws.com
</code></pre></div>

<p>You can verify that livy server UI is available at localhost:8998</p>
<p>Leave the shell open for connection to be maintained or you can detach it using nohup or any tool of your choice.</p>
<h2>Launching Jupyter Server</h2>
<p>Now we launch jupyter server using command: <code>jupyter notebook</code></p>
<p><img alt="Jupyter Notebook" src="/blogs/devops-jupyter-connect-aws-glue/2020/11/jupyter_notebook.png"></p>
<p>As you can see now you can find two new kernels PySpark (for python) and Spark (for scala).</p>
<p><img alt="Spark Scala" src="/blogs/devops-jupyter-connect-aws-glue/2020/11/spark_scala.png"></p>
<p>As you can see we can access Glue Spark and also save the notebook when the endpoint is stopped.</p>
<p>Also, you can access livy server UI to monitor multiple sessions by going to:</p>
<p><img alt="livy server" src="/blogs/devops-jupyter-connect-aws-glue/2020/11/livy_server.png"></p>
<h2>Benefits</h2>
<ul>
<li>No need to keep endpoint running as all codes are saved to your notebook.</li>
<li>No need to extract data out of S3 to your notebook to perform feature engineering.</li>
<li>Can share the spark cluster among the team, resulting in cost saving.</li>
<li>Can perform ad hoc logic of TB’s of data.</li>
<li>Endpoint can scale to 50 DPU which is approximately (16 x 50 = 800 GB memory and 4 x 50 = 200 cores) 100 executors.</li>
</ul>
<h2>Pricing</h2>
<p>Glue is priced per DPU which stands for Data Processing Unit</p>
<p>$0.44/Hour/DPU, billed per second, with a 10-minute minimum.</p>
<h2>Bibliography</h2>
<ul>
<li>https://blog.chezo.uno/livy-jupyter-notebook-sparkmagic-powerful-easy-notebook-for-data-scientist-a8b72345ea2d</li>
</ul>
<p><strong>P.S. Please delete the endpoint after your development or be ready for big fat bill from AWS</strong></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/devops.html">devops</a>
    </p>
  </div>






</article>

<footer>
<p>&copy; 2024 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Professional Portfolio ",
  "url" : "",
  "image": "",
  "description": ""
}
</script>
</body>
</html>